
# ğŸ§  CA6000 Programming Notes (Topic 4--6)
# ğŸ“˜ Python æ•™ç¨‹ï¼ˆModules, Regex, NumPy, File I/O, Local LLMï¼‰



# ğŸ“‘  **Python Programming Notes â€” æ€»ç›®å½•ï¼ˆTable of Contentsï¼‰**

> è¦†ç›–å†…å®¹ï¼šModulesã€Regexã€NumPyã€File I/Oã€OOPã€Local LLM
> é€‚ç”¨äºè¯¾ç¨‹ CA6000 
---
## **ç¬¬ 4 ç« ï¼šModules & Packagesï¼ˆæ¨¡å—ä¸åŒ…ï¼‰**

* 4.1 æ¨¡å—çš„æ¦‚å¿µ
* 4.2 æ¨¡å—çš„ä¼˜åŠ¿
* 4.3 import çš„æ‰€æœ‰ç”¨æ³•
* 4.4 è‡ªå®šä¹‰æ¨¡å—
* 4.5 `__name__ == "__main__"`
* 4.6 åŒ…ï¼ˆPackageï¼‰ä¸ `__init__.py`
* 4.7 pip / conda åŒ…ç®¡ç†

---

## **ç¬¬ 5 ç« ï¼šRegexï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰**

* 5.1 åŸºæœ¬å…ƒå­—ç¬¦ä¸è¯­æ³•
* 5.2 `re` æ¨¡å—
* 5.3 æ•è·ç»„ / å‘½åç»„
* 5.4 è´ªå©ª / éè´ªå©ªé‡è¯
* 5.5 Lookahead / Lookbehind
* 5.6 Flagsï¼ˆæ ‡å¿—ï¼‰
* 5.7 æ€§èƒ½ä¼˜åŒ–
* 5.8 å®æˆ˜é¡¹ç›®ï¼ˆé‚®ç®±æå–ã€æ—¥å¿—è§£æç­‰ï¼‰
* 5.9 ç»ƒä¹ é¢˜

---

## **ç¬¬ 6 ç« ï¼šNumPyï¼ˆæ•°ç»„ã€å¹¿æ’­ã€é«˜é˜¶ç‰¹æ€§ï¼‰**

* 6.1 NumPy ç®€ä»‹
* 6.2 ndarray å†…å­˜ç»“æ„ï¼ˆshape / dtype / stridesï¼‰
* 6.3 dtype æ·±åº¦è§£æ
* 6.4 å†…å­˜å¸ƒå±€ï¼ˆC-order / F-orderï¼‰
* 6.5 stridesï¼ˆé«˜é˜¶ï¼‰
* 6.6 æ•°ç»„åˆ›å»º
* 6.7 ç´¢å¼•ä¸åˆ‡ç‰‡
* 6.8 è§†å›¾ vs æ‹·è´
* 6.9 å¹¿æ’­ï¼ˆBroadcastingï¼‰
* 6.10 ufuncï¼ˆé€šç”¨å‡½æ•°ï¼‰
* 6.11 random éšæœºåˆ†å¸ƒï¼ˆé«˜é˜¶ï¼‰
* 6.12 matrix vs ndarray
* 6.13 çº¿æ€§ä»£æ•°
* 6.14 æ•°å€¼è®¡ç®—å®æˆ˜
* 6.15 ç»ƒä¹ é¢˜

---

## **ç¬¬ 7 ç« ï¼šæ–‡ä»¶ I/Oï¼ˆFile Input & Outputï¼‰**

* 7.1 æ–‡ä»¶ä¸ open()
* 7.2 è¯»å†™æ¨¡å¼ï¼ˆr/w/a/b/x/+ï¼‰
* 7.3 æ–‡æœ¬è¯»å†™
* 7.4 Unicode ç¼–ç ä¸è§£ç 
* 7.5 æ–‡ä»¶æŒ‡é’ˆï¼šseek / tell
* 7.6 äºŒè¿›åˆ¶è¯»å†™
* 7.7 ç¼“å†²åŒºï¼ˆbufferï¼‰æœºåˆ¶
* 7.8 ä¸Šä¸‹æ–‡ç®¡ç†å™¨åŸç†ï¼ˆ__enter__ / __exit__ï¼‰
* 7.9 CSV æ–‡ä»¶
* 7.10 JSON æ–‡ä»¶
* 7.11 pathlib æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
* 7.12 å®æˆ˜æ¡ˆä¾‹
* 7.13 ç»ƒä¹ é¢˜

---

## **ç¬¬ 8 ç« ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰**

* 8.1 ä»€ä¹ˆæ˜¯ OOP
* 8.2 ç±»ä¸å¯¹è±¡
* 8.3 æ„é€ æ–¹æ³• `__init__`
* 8.4 å±æ€§ä¸æ–¹æ³•
* 8.5 ç±»å±æ€§ vs å®ä¾‹å±æ€§
* 8.6 å°è£…ï¼ˆEncapsulationï¼‰
* 8.7 ç§æœ‰å±æ€§ä¸ä¿æŠ¤å±æ€§
* 8.8 ç»§æ‰¿ï¼ˆInheritanceï¼‰
* 8.9 super() ä¸æ–¹æ³•é‡å†™
* 8.10 å¤šé‡ç»§æ‰¿ & MRO
* 8.11 å¤šæ€ï¼ˆPolymorphismï¼‰
* 8.12 é­”æœ¯æ–¹æ³•ï¼ˆMagic Methodsï¼‰
* 8.13 ç±»æ–¹æ³•ä¸é™æ€æ–¹æ³•
* 8.14 æŠ½è±¡ç±»
* 8.15 OOP å®æˆ˜é¡¹ç›®
* 8.16 ç»ƒä¹ é¢˜

---

## **ç¬¬ 9 ç« ï¼šLocal LLMï¼ˆæœ¬åœ°å¤§è¯­è¨€æ¨¡å‹ï¼‰**

* 9.1 ä»€ä¹ˆæ˜¯ Local LLM
* 9.2 LLM ç»„æˆï¼ˆTokenizer + Model + Weightsï¼‰
* 9.3 æ¨¡å‹æ ¼å¼ï¼ˆ.bin / safetensors / ggufï¼‰
* 9.4 HuggingFace æ¨¡å‹ä¸‹è½½
* 9.5 Transformers æ¨¡å‹åŠ è½½
* 9.6 Pipeline æ–‡æœ¬ç”Ÿæˆ
* 9.7 æ‰‹åŠ¨æ¨ç† generate()
* 9.8 GPU / CPU / device_map
* 9.9 4-bit / 8-bit é‡åŒ–
* 9.10 æ„å»ºæœ¬åœ°èŠå¤©æœºå™¨äºº
* 9.11 æ–‡æœ¬ç”Ÿæˆå‚æ•°ï¼ˆtemperature ç­‰ï¼‰
* 9.12 æœ¬åœ° LLM Demo å®Œæ•´é¡¹ç›®
* 9.13 å¸¸è§é”™è¯¯æ’æŸ¥
* 9.14 ç»ƒä¹ é¢˜

---


# -----------------------------------

# ğŸ¯ **ç¬¬ 4 ç« ï¼šModules & Packagesï¼ˆæ¨¡å—ä¸åŒ…ï¼‰**

# -----------------------------------

## 4.1 æ¨¡å—çš„æ¦‚å¿µï¼ˆæ¥è‡ª PDF + æ‰©å±•ï¼‰

### ğŸ“Œ è‹±æ–‡å®šä¹‰ï¼ˆPDF åŸç†ï¼‰

A module is a `.py` file that contains Python code such as variables, functions, and classes.
Modules help organize reusable code logically and improve maintainability.

### ğŸ“Œ ä¸­æ–‡å®šä¹‰ï¼ˆæ‰©å±•ç‰ˆï¼‰

æ¨¡å—å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Python æ–‡ä»¶ï¼ˆæ‰©å±•åä¸º `.py`ï¼‰ï¼Œå†…éƒ¨å¯ä»¥åŒ…å«ï¼š

* å˜é‡
* å¸¸é‡
* å‡½æ•°
* ç±»
* å¯æ‰§è¡Œè¯­å¥

ä½ å¯ä»¥æŠŠæ¨¡å—ç†è§£ä¸ºâ€œå¤ç”¨ä»£ç çš„æ–‡ä»¶å¤¹æŠ½å±‰â€ï¼ŒæŠŠå¸¸ç”¨åŠŸèƒ½æ”¾è¿›å»ï¼Œåˆ«çš„ç¨‹åºå¯ä»¥éšæ—¶å¯¼å…¥ä½¿ç”¨ã€‚

---

## â­ æ¨¡å—å¸¦æ¥çš„ä¸‰å¤§å¥½å¤„

### âœ” 1. ä»£ç å¤ç”¨ (Code Reuse)

é‡å¤ä½¿ç”¨å‡½æ•°ã€ç±»ï¼ˆä¾‹å¦‚ï¼šæ•°å­¦å·¥å…·ã€æ•°æ®åº“è¿æ¥å·¥å…·ã€æ–‡æœ¬å¤„ç†å·¥å…·ï¼‰

### âœ” 2. é€»è¾‘åˆ†å±‚ (Project Organization)

å¤§å‹é¡¹ç›®å¯ä»¥æŒ‰åŠŸèƒ½æ‹†åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œä¾‹å¦‚ï¼š

```
math_utils.py
string_utils.py
file_utils.py
```

### âœ” 3. é¿å…å‘½åå†²çª (Namespace Isolation)

æ¯ä¸ªæ¨¡å—éƒ½æ˜¯ç‹¬ç«‹çš„å‘½åç©ºé—´ï¼Œä¸ä¼šäº’ç›¸æ±¡æŸ“ã€‚

---

## 4.2 import çš„æ‰€æœ‰ä½¿ç”¨æ–¹å¼ï¼ˆæ¥è‡ª PDF + é«˜çº§æ‰©å±•ï¼‰

Python æä¾›å¤šç§å¯¼å…¥æ–¹å¼ï¼Œç†è§£å®ƒä»¬éå¸¸é‡è¦ã€‚

---

### âœ” **ï¼ˆ1ï¼‰æœ€åŸºæœ¬çš„å¯¼å…¥æ–¹å¼**

```python
import math

print(math.sqrt(16))   # è°ƒç”¨æ¨¡å—é‡Œçš„å‡½æ•°
```

---

### âœ” **ï¼ˆ2ï¼‰ç»™æ¨¡å—è®¾ç½®åˆ«åï¼ˆaliasï¼‰**

å¸¸ç”¨äºç®€åŒ–å¤§å‹æ¨¡å—åç§°ï¼š

```python
import numpy as np   # æ¨èå†™æ³•

arr = np.array([1,2,3])
print(arr)
```

---

### âœ” **ï¼ˆ3ï¼‰åªå¯¼å…¥ç‰¹å®šåç§°**

ä»æ¨¡å—é‡Œé€‰ä½ è¦çš„åŠŸèƒ½ï¼š

```python
from random import randint, choice

print(randint(1, 10))
print(choice(["a", "b", "c"]))
```

âš ï¸ **ä¼˜ç‚¹**ï¼šå‡å°‘æ¨¡å—åŠ è½½å†…å®¹
âš ï¸ **ç¼ºç‚¹**ï¼šå®¹æ˜“é€ æˆå‘½åå†²çªï¼ˆä¸æ¨èå¤§é‡ä½¿ç”¨ï¼‰

---

### âœ” **ï¼ˆ4ï¼‰å¯¼å…¥æ‰€æœ‰å†…å®¹ï¼ˆä¸æ¨èï¼‰**

```python
from math import *
print(sqrt(9))
```

âš ï¸ **ä¸¥é‡ç¼ºç‚¹ï¼šæ±¡æŸ“å‘½åç©ºé—´ï¼Œä¸å¯è¯»ï¼Œä¸æ˜“ç»´æŠ¤**

---

### âœ” **ï¼ˆ5ï¼‰æŸ¥çœ‹æ¨¡å—å†…æ‰€æœ‰å±æ€§ï¼ˆPDF æœ‰ä»‹ç»ï¼‰**

```python
import random
print(dir(random))  # æ‰“å°æ¨¡å—æ‰€æœ‰å‡½æ•°ã€å˜é‡
```

---

## 4.3 è‡ªå®šä¹‰æ¨¡å—ï¼ˆPDF åŸºç¡€ + å®æˆ˜æ‰©å±•ï¼‰

### ğŸ“Œ ä¸€ä¸ªæ¨¡å—å…¶å®å°±æ˜¯ä¸€ä¸ª `.py` æ–‡ä»¶

ä¾‹å¦‚åˆ›å»º `my_module.py`ï¼š

```python
# my_module.py
# è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ¨¡å—ç¤ºä¾‹

PI = 3.14159   # ä¸€ä¸ªå¸¸é‡

def greeting(name):
    """ä¸€ä¸ªç®€å•çš„é—®å€™å‡½æ•°"""
    return f"Hello, {name}!"

def area_circle(r):
    """è¿”å›åœ†çš„é¢ç§¯"""
    return PI * r * r
```

---

### ğŸ“Œ ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å—

```python
import my_module

print(my_module.greeting("Alice"))
print(my_module.area_circle(3))
```

---

## 4.4 `__name__ == "__main__"`ï¼ˆPDF å¼ºè°ƒç‚¹ï¼‰

è¿™æ˜¯ Python ä¸­éå¸¸é‡è¦çš„æœºåˆ¶ã€‚

### ğŸ§  åŠŸèƒ½è¯´æ˜

* å½“æ¨¡å—è¢« *ç›´æ¥è¿è¡Œ* æ—¶ï¼š`__name__ == "__main__"`
* å½“æ¨¡å—è¢« *import å¯¼å…¥* æ—¶ï¼š`__name__ != "__main__"`ï¼ˆè€Œæ˜¯æ¨¡å—æ–‡ä»¶åï¼‰

### å…¸å‹ç”¨é€”ï¼š

* ç»™æ¨¡å—æä¾›æµ‹è¯•ä»£ç ï¼Œè€Œä¸ä¼šåœ¨ import æ—¶æ‰§è¡Œã€‚

---

### âœ” ä»£ç ç¤ºä¾‹ï¼ˆå¸¦è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼‰

```python
# my_module.py

def add(a, b):
    return a + b

def main():
    print("æ¨¡å—æµ‹è¯•ï¼š")
    print("add(3,5)=", add(3,5))

# åªæœ‰å½“ç›´æ¥è¿è¡Œ python my_module.py æ—¶æ‰ä¼šæ‰§è¡Œ
if __name__ == "__main__":
    main()
```

### è¿è¡Œæ–¹å¼ï¼š

ï¼ˆ1ï¼‰ç›´æ¥è¿è¡Œï¼š

```
python my_module.py
```

è¾“å‡ºï¼š

```
æ¨¡å—æµ‹è¯•ï¼š
add(3,5)= 8
```

ï¼ˆ2ï¼‰åˆ«çš„æ–‡ä»¶ä¸­ import æ—¶ï¼š

```python
import my_module
```

ä¸ä¼šè¾“å‡ºä»»ä½•æµ‹è¯•å†…å®¹ã€‚

---

## 4.5 åŒ…ï¼ˆPackageï¼‰ä¸ `__init__.py`ï¼ˆPDF é‡è¦å†…å®¹ï¼‰

### ğŸ“¦ åŒ…ï¼ˆPackageï¼‰å°±æ˜¯åŒ…å«å¤šä¸ªæ¨¡å—çš„æ–‡ä»¶å¤¹ã€‚

å¿…é¡»å…·å¤‡ï¼š

```
mypkg/
    __init__.py   â† åŒ…æ–‡ä»¶
    math_utils.py
    string_utils.py
```

---

### âœ” ç¤ºä¾‹ï¼šåˆ›å»ºåŒ…ç»“æ„

```bash
mypkg/
    __init__.py
    math_utils.py
    str_utils.py
```

### **math_utils.py**

```python
def add(a, b):
    return a + b
```

### **str_utils.py**

```python
def shout(s):
    return s.upper() + "!"
```

### ****init**.py**

```python
from .math_utils import add
from .str_utils import shout

__all__ = ["add", "shout"]
```

---

### ä½¿ç”¨åŒ…ï¼š

```python
import mypkg

print(mypkg.add(2, 3))
print(mypkg.shout("hello"))
```

---

## 4.6 pip / condaï¼ˆPDF æœ‰éƒ¨åˆ†å†…å®¹ï¼Œè¿™é‡Œæ‰©å±•ï¼‰

### âœ” pipï¼šPython å®˜æ–¹åŒ…ç®¡ç†å™¨

```bash
pip install numpy
pip uninstall numpy
pip list
```

---

### âœ” condaï¼šAnaconda ç¯å¢ƒç®¡ç†å™¨ï¼ˆé€‚åˆç§‘å­¦è®¡ç®—ï¼‰

```bash
conda create -n myenv python=3.10
conda activate myenv
conda install numpy pandas
```

---





â†’ **ç¬¬ 5 ç« ï¼šRegex æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ¥è‡ª PDF + å¤§é‡æ‰©å±•ï¼‰**
å†…å®¹å°†åŒ…æ‹¬ï¼š

* æ‰€æœ‰æ­£åˆ™ç¬¦å·è¯¦ç»†è§£é‡Š
* æ•è·ç»„ / éæ•è·ç»„
* è´ªå©ª / éè´ªå©ª
* re.search / re.findall / re.sub / re.compile
* å¤§é‡å®ä¾‹ + ä¸­æ–‡æ³¨é‡Š

---

å¥½çš„ï¼Œç»§ç»­ç¬¬ **2 ç« ï¼šæ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegexï¼‰**ã€‚
ä¸‹é¢æˆ‘ä¼šæŠŠæ­£åˆ™è¡¨è¾¾å¼ä»**åŸç†**åˆ°**å®æˆ˜**é€æ­¥å±•å¼€ï¼Œå†…å®¹åŒ…æ‹¬ï¼šè¯­æ³•è¯¦è§£ã€å¸¸è§ç”¨æ³•ã€è´ªå©ª/éè´ªå©ªã€æ•è·ç»„/å‘½åç»„ã€å‰åå‘æ–­è¨€ï¼ˆlookahead/lookbehindï¼‰ã€ç¼–è¯‘ä¼˜åŒ–ã€å¸¸è§é”™è¯¯ã€ä»¥åŠè‹¥å¹²å®æˆ˜æ¡ˆä¾‹ï¼ˆæ—¥å¿—è§£æã€é‚®ç®±/æ‰‹æœºå·æå–ã€HTML æ ‡ç­¾æ¸…æ´—ï¼‰ã€‚æ¯ä¸ªä¾‹å­éƒ½åŒ…å«**è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š**ï¼Œå¯ä»¥ç›´æ¥åœ¨ Colab / æœ¬åœ°è¿è¡Œå­¦ä¹ ã€‚

---

# ç¬¬ 5 ç«  â€” Regexï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰

## 5.0 æœ¬ç« ç›®æ ‡ï¼ˆä¸­è‹±ï¼‰

* **ä¸­æ–‡**ï¼šå­¦ä¼šä½¿ç”¨ Python çš„ `re` æ¨¡å—è¿›è¡Œé«˜æ•ˆçš„æ–‡æœ¬åŒ¹é…ã€æå–å’Œæ›¿æ¢ï¼ŒæŒæ¡æ‰€æœ‰å¸¸ç”¨æ­£åˆ™è¯­æ³•ä¸è¿›é˜¶æŠ€å·§ï¼Œå¹¶é€šè¿‡å®æˆ˜æ¡ˆä¾‹ç†è§£å¦‚ä½•åº”ç”¨äºæ•°æ®æ¸…æ´—ä¸è§£æä»»åŠ¡ã€‚
* **English**: Learn Python's `re` module for matching, extracting and replacing text; master common regex syntax and advanced features; apply to real data cleaning and parsing tasks.

---

## 5.1 åŸºæœ¬æ¦‚å¿µä¸å¸¸ç”¨ç¬¦å·ï¼ˆè¯¦è§£ï¼‰

ä¸‹é¢æ˜¯æ­£åˆ™é‡Œå¸¸è§çš„å…ƒå­—ç¬¦ï¼ˆmetacharactersï¼‰åŠå«ä¹‰ï¼š

* `.` ï¼šåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ï¼ˆé»˜è®¤ä¸åŒ¹é…æ¢è¡Œï¼Œé™¤éä½¿ç”¨ DOTALLï¼‰
* `^` ï¼šåŒ¹é…å­—ç¬¦ä¸²å¼€å¤´ï¼ˆåœ¨å¤šè¡Œæ¨¡å¼ä¸­åŒ¹é…æ¯è¡Œå¼€å¤´ï¼‰
* `$` ï¼šåŒ¹é…å­—ç¬¦ä¸²ç»“å°¾ï¼ˆåœ¨å¤šè¡Œæ¨¡å¼ä¸­åŒ¹é…æ¯è¡Œç»“å°¾ï¼‰
* `*` ï¼šå‰é¢çš„å…ƒç´ é‡å¤ 0 æ¬¡æˆ–å¤šæ¬¡ï¼ˆè´ªå©ªï¼‰
* `+` ï¼šé‡å¤ 1 æ¬¡æˆ–å¤šæ¬¡ï¼ˆè´ªå©ªï¼‰
* `?` ï¼šé‡å¤ 0 æ¬¡æˆ– 1 æ¬¡ï¼ˆä¹Ÿç”¨äºéè´ªå©ªæ ‡è®°ï¼‰
* `{m,n}` ï¼šé‡å¤è‡³å°‘ m æ¬¡ï¼Œæœ€å¤š n æ¬¡
* `[]` ï¼šå­—ç¬¦é›†åˆï¼ˆå­—ç¬¦ç±»ï¼‰ï¼Œä¾‹å¦‚ `[abc]` åŒ¹é… 'a' æˆ– 'b' æˆ– 'c'
* `\d` ï¼šæ•°å­—å­—ç¬¦ï¼Œç›¸å½“äº `[0-9]`
* `\D` ï¼šéæ•°å­—å­—ç¬¦
* `\w` ï¼šå•è¯å­—ç¬¦ï¼ˆå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼‰ï¼Œç›¸å½“äº `[A-Za-z0-9_]`
* `\W` ï¼šéå•è¯å­—ç¬¦
* `\s` ï¼šç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œï¼‰
* `\S` ï¼šéç©ºç™½å­—ç¬¦
* `()` ï¼šæ•è·ç»„ï¼ˆcapture groupï¼‰
* `(?:...)` ï¼šéæ•è·ç»„ï¼ˆä¸åˆ›å»ºæ•è·ç»„ï¼‰
* `(?P<name>...)` ï¼šå‘½åæ•è·ç»„
* `(?=...)` ï¼šæ­£å‘å‰ç»ï¼ˆpositive lookaheadï¼‰
* `(?!...)` ï¼šè´Ÿå‘å‰ç»ï¼ˆnegative lookaheadï¼‰
* `(?<=...)` ï¼šæ­£å‘åç»ï¼ˆpositive lookbehindï¼‰
* `(?<!...)` ï¼šè´Ÿå‘åç»ï¼ˆnegative lookbehindï¼‰
* `|` ï¼šæˆ–ï¼ˆalternationï¼‰
* `re.IGNORECASE / re.I`ï¼šå¿½ç•¥å¤§å°å†™æ ‡å¿—
* `re.MULTILINE / re.M`ï¼šå¤šè¡Œæ¨¡å¼ï¼Œä½¿ `^` å’Œ `$` åŒ¹é…æ¯ä¸€è¡Œ
* `re.DOTALL / re.S`ï¼šä½¿ `.` åŒ¹é…æ¢è¡Œç¬¦

---

## 5.2 Python `re` æ¨¡å—å¸¸ç”¨å‡½æ•°

* `re.match(pattern, string)`ï¼šä»å­—ç¬¦ä¸²å¼€å¤´å°è¯•åŒ¹é…ï¼ˆè‹¥ä»å¼€å¤´ä¸åŒ¹é…åˆ™è¿”å› Noneï¼‰
* `re.search(pattern, string)`ï¼šåœ¨æ•´ä¸ªå­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…
* `re.findall(pattern, string)`ï¼šè¿”å›å­—ç¬¦ä¸²ä¸­æ‰€æœ‰éé‡å åŒ¹é…çš„åˆ—è¡¨ï¼ˆä»…è¿”å›åŒ¹é…æ–‡æœ¬æˆ–å­ç»„ï¼‰
* `re.finditer(pattern, string)`ï¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿­ä»£ `Match` å¯¹è±¡
* `re.sub(pattern, repl, string)`ï¼šæ›¿æ¢åŒ¹é…åˆ°çš„å†…å®¹
* `re.split(pattern, string)`ï¼šæŒ‰åŒ¹é…åˆ†å‰²å­—ç¬¦ä¸²
* `re.compile(pattern, flags=0)`ï¼šç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿”å› `Pattern` å¯¹è±¡ï¼ˆç”¨äºé‡å¤åŒ¹é…æˆ–æ€§èƒ½ä¼˜åŒ–ï¼‰

---

## 5.3 æ•è·ç»„ä¸å‘½åç»„ï¼ˆCapture Groups & Named Groupsï¼‰

æ•è·ç»„ä¼šæŠŠåŒ¹é…åˆ°çš„å­ä¸²ä¿å­˜åœ¨ `Match` å¯¹è±¡ä¸­ï¼Œä½¿ç”¨ `group()` è·å–ã€‚

ç¤ºä¾‹ â€” æå–æ—¥æœŸ `YYYY-MM-DD` çš„å¹´æœˆæ—¥ï¼š

```python
import re

text = "äº‹ä»¶å‘ç”Ÿåœ¨ 2024-11-05ï¼Œä¹Ÿå¯èƒ½åœ¨ 2025-01-10ã€‚"

# æ•è·ç»„ç¤ºä¾‹ï¼šä¸‰ä¸ªæ•è·ç»„åˆ†åˆ«è¡¨ç¤ºå¹´ã€æœˆã€æ—¥
pattern = r"(\d{4})-(\d{2})-(\d{2})"

matches = re.findall(pattern, text)
print("findall è¿”å›çš„æ˜¯ tuplesï¼š", matches)
# è¾“å‡º: [('2024', '11', '05'), ('2025', '01', '10')]

# ä½¿ç”¨ search æˆ– finditer è·å– Match å¯¹è±¡ï¼Œè¿›è€Œä½¿ç”¨ group()
m = re.search(pattern, text)
if m:
    print("year:", m.group(1))
    print("month:", m.group(2))
    print("day:", m.group(3))

# å‘½åæ•è·ç»„ï¼ˆæ›´å¯è¯»ï¼‰
pattern_named = r"(?P<year>\d{4})-(?P<month>\d{2})-(?P<day>\d{2})"
m2 = re.search(pattern_named, text)
if m2:
    print("named groups:", m2.groupdict())  # {'year': '2024', 'month': '11', 'day': '05'}
```

**ä¸­æ–‡æ³¨é‡Šè¯´æ˜ï¼š**

* `(\d{4})` æ˜¯ç¬¬ 1 ä¸ªæ•è·ç»„ï¼Œ`m.group(1)` è·å–å…¶å€¼ï¼›
* `(?P<year>...)` ç»™æ•è·ç»„èµ·åï¼Œ`m.groupdict()` è¿”å›æ‰€æœ‰å‘½åå­ç»„å½¢æˆçš„ dictï¼Œæ›´åˆ©äºç»´æŠ¤ã€‚

---

## 5.4 è´ªå©ªï¼ˆGreedyï¼‰ vs éè´ªå©ªï¼ˆNon-greedy / Lazyï¼‰

* é»˜è®¤é‡è¯ï¼ˆ`*`, `+`, `{m,n}`ï¼‰æ˜¯è´ªå©ªçš„ï¼Œä¼šå°½å¯èƒ½å¤šåœ°åŒ¹é…ã€‚
* åœ¨é‡è¯ååŠ  `?` å˜ä¸ºéè´ªå©ªï¼ŒåŒ¹é…å°½å¯èƒ½å°‘ã€‚

ç¤ºä¾‹ â€” åŒ¹é… HTML æ ‡ç­¾ä¹‹é—´çš„å†…å®¹ï¼š

```python
import re

s = "<p>ç¬¬ä¸€æ®µ</p><p>ç¬¬äºŒæ®µ</p>"

# è´ªå©ªæ¨¡å¼ï¼š.* ä¼šåå°½å¯èƒ½å¤šçš„å­—ç¬¦
m_greedy = re.findall(r"<p>.*</p>", s)
print("è´ªå©ª findall:", m_greedy)
# è¾“å‡ºå¯èƒ½ä¸º ['<p>ç¬¬ä¸€æ®µ</p><p>ç¬¬äºŒæ®µ</p>'] ï¼ˆæ•´ä¸ªä¸²è¢«ä¸€æ¬¡æ€§åŒ¹é…ï¼‰

# éè´ªå©ªæ¨¡å¼ï¼š.*? å°½å¯èƒ½å°‘åŒ¹é…
m_lazy = re.findall(r"<p>.*?</p>", s)
print("éè´ªå©ª findall:", m_lazy)
# è¾“å‡º: ['<p>ç¬¬ä¸€æ®µ</p>', '<p>ç¬¬äºŒæ®µ</p>']
```

**ä¸­æ–‡æ³¨é‡Šï¼š**

* åœ¨å¤„ç† HTML/XML ç­‰åµŒå¥—æ–‡æœ¬æ—¶é€šå¸¸éœ€è¦ä½¿ç”¨éè´ªå©ªé‡è¯ `*?` æˆ–è€…æ›´ç²¾ç¡®çš„æ¨¡å¼ï¼ˆæˆ–ä½¿ç”¨è§£æå™¨å¦‚ BeautifulSoupï¼‰ã€‚

---

## 5.5 lookahead / lookbehindï¼ˆå‰åå‘æ–­è¨€ï¼‰

æ–­è¨€ç”¨äºåœ¨ä¸æ¶ˆè€—å­—ç¬¦ä¸²å­—ç¬¦çš„æƒ…å†µä¸‹è¿›è¡Œä½ç½®åˆ¤æ–­ï¼ˆå³ä¸æŠŠæ–­è¨€ä¸­çš„å†…å®¹åŒ…å«åˆ°åŒ¹é…ç»“æœé‡Œï¼‰ã€‚

* æ­£å‘å‰ç» `(?=...)`ï¼šassert åé¢æ˜¯ `...`
* è´Ÿå‘å‰ç» `(?!...)`ï¼šassert åé¢ä¸æ˜¯ `...`
* æ­£å‘åç» `(?<=...)`ï¼šassert å‰é¢æ˜¯ `...`
* è´Ÿå‘åç» `(?<!...)`ï¼šassert å‰é¢ä¸æ˜¯ `...`

ç¤ºä¾‹ â€” æå–ç´§è·Ÿåœ¨ `$` åé¢çš„æ•°å­—ï¼ˆè´§å¸é‡‘é¢ï¼‰ï¼Œä½†ä¸åŒ…å« `$` ç¬¦å·ï¼š

```python
import re

s = "å•†å“ A: $100, å•†å“ B: $250, æŠ˜æ‰£: 30%"

# ä½¿ç”¨æ­£å‘åç» (?<=\$) åŒ¹é…åœ¨ $ ä¹‹åçš„æ•°å­—ï¼ˆ\d+ï¼‰
amounts = re.findall(r"(?<=\$)\d+", s)
print("æ‰¾åˆ°çš„é‡‘é¢ï¼ˆä¸å« $ ç¬¦å·ï¼‰:", amounts)
# è¾“å‡º: ['100', '250']
```

ç¤ºä¾‹ â€” åŒ¹é…é‚®ç®±ä½†æ’é™¤æŸäº›åŸŸåï¼ˆè´Ÿå‘å‰ç»ï¼‰ï¼š

```python
import re

text = "hi@openai.com, bad@spam.com, user@example.org"
# æ‰¾åˆ°é‚®ç®±ä½†æ’é™¤åŸŸä¸º spam.com
pattern = r"[a-zA-Z0-9._%+-]+@(?!spam\.com)[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"
valid = re.findall(pattern, text)
print("æ’é™¤ spam.com åçš„é‚®ç®±:", valid)
# è¾“å‡º: ['hi@openai.com', 'user@example.org']
```

**æ³¨æ„**ï¼šPython çš„åç»å›ºå®šå®½åº¦é™åˆ¶ï¼š`(?<=...)` å†…ä¸èƒ½ä½¿ç”¨å¯å˜é•¿åº¦é‡è¯ï¼ˆæŸäº›å®ç°å…è®¸ï¼Œä½† Python å¯¹åç»é‡Œçš„é•¿åº¦é€šå¸¸è¦æ±‚æ˜¯å›ºå®šæˆ–ç¡®å®šçš„èŒƒå›´ï¼‰ã€‚

---

## 5.6 re.compileï¼ˆé¢„ç¼–è¯‘ï¼‰ä¸ Flagsï¼ˆæ ‡å¿—ä½ï¼‰

å½“åŒä¸€æ­£åˆ™æ¨¡å¼ä¼šè¢«å¤šæ¬¡ä½¿ç”¨æ—¶ï¼Œé¢„ç¼–è¯‘èƒ½æå‡æ•ˆç‡å¹¶æ–¹ä¾¿å¤ç”¨ï¼›åŒæ—¶å¯ä»¥ç”¨ flags æ§åˆ¶è¡Œä¸ºï¼ˆå¿½ç•¥å¤§å°å†™ã€å¤šè¡Œã€DOTALL ç­‰ï¼‰ã€‚

ç¤ºä¾‹ â€” ç¼–è¯‘æ¨¡å¼å¹¶ä½¿ç”¨ `re.I` å¿½ç•¥å¤§å°å†™ï¼š

```python
import re

text = "Error: File not found\nerror: æ— æ³•è®¿é—®\nERROR: æƒé™ä¸è¶³"

# ç¼–è¯‘æ­£åˆ™ï¼ŒåŠ å…¥ IGNORECASE æ ‡å¿—ï¼Œä»¥åŒ¹é…ä¸åŒå¤§å°å†™çš„ "error"
pattern = re.compile(r"error: (.+)", flags=re.I)

for m in pattern.finditer(text):
    print("åŒ¹é…åˆ°ï¼š", m.group(1))
```

---

## 5.7 å¸¸è§é”™è¯¯ä¸é™·é˜±ï¼ˆå®æˆ˜ç»éªŒï¼‰

* **è¯¯ç”¨ `re.match` ä»¥ä¸ºæ˜¯å…¨å±€æŸ¥æ‰¾**ï¼š`re.match` åªä»èµ·å§‹ä½ç½®åŒ¹é…ï¼Œè‹¥éœ€ä»»æ„ä½ç½®åŒ¹é…åº”ç”¨ `re.search`ã€‚
* **å¿˜è®°è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦**ï¼š`"."`ã€`"*"`, `"$"` ç­‰æœ‰ç‰¹æ®Šå«ä¹‰ï¼ŒåŒ¹é…å­—é¢å­—ç¬¦éœ€ç”¨ `\.`ã€`\*` ç­‰æˆ–ä½¿ç”¨ `re.escape()`ã€‚
* **è´ªå©ªåæ‰å¤ªå¤šå†…å®¹**ï¼šå¤„ç† HTML æˆ–åµŒå¥—ç»“æ„æ—¶åº”ä½¿ç”¨éè´ªå©ªæˆ–ä¸“é—¨è§£æå™¨ã€‚
* **å¿½è§† Unicode / ç¼–ç é—®é¢˜**ï¼šåœ¨å¤„ç†é ASCII æ–‡æœ¬æ—¶æ³¨æ„ `re.UNICODE`ï¼ˆPython3 é»˜è®¤å·²è‰¯å¥½æ”¯æŒï¼‰ï¼›`re` æ¨¡å¼ä¸­çš„ `\w` å¯èƒ½ä¸åŒ¹é…ä¸­æ–‡ã€‚
* **åç»é•¿åº¦é™åˆ¶**ï¼šåç»æ–­è¨€å†…ä¸€èˆ¬ä¸å…è®¸å¯å˜é•¿åº¦åŒ¹é…ï¼ˆè§† Python ç‰ˆæœ¬å’Œè¯­æ³•é™åˆ¶ï¼‰ã€‚

---

## 5.8 å®æˆ˜æ¡ˆä¾‹ï¼ˆå¤šç¤ºä¾‹ï¼Œå«ä¸­æ–‡æ³¨é‡Šï¼‰

### æ¡ˆä¾‹ A â€” æå–æ–‡æœ¬ä¸­çš„æ‰€æœ‰é‚®ç®±åœ°å€

```python
import re

text = """
è”ç³»ï¼šsupport@example.com, é”€å”®ï¼šsales@company.co.ukï¼Œ
ä¸åˆæ³•é‚®ç®±ï¼šbad@@domain, å…¶å®ƒï¼šuser.name+tag+sorting@example.com
"""

# ä¸€ä¸ªå®ç”¨çš„é‚®ç®±æ­£åˆ™ï¼ˆé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼Œä½†ä¸æ˜¯ RFC å®Œæ•´è§„èŒƒï¼‰
email_pattern = r"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"

emails = re.findall(email_pattern, text)
print("æå–åˆ°çš„é‚®ç®±ï¼š", emails)
# æ³¨é‡Šï¼šæ­¤æ¨¡å¼å¿½ç•¥ä¸€äº›æç«¯åˆæ³•é‚®ç®±ï¼ˆRFC å…è®¸æ›´å¤æ‚æƒ…å†µï¼‰ï¼Œä½†é€‚åˆå¸¸è§„æ¸…æ´—
```

---

### æ¡ˆä¾‹ B â€” æå–ä¸­å›½æ‰‹æœºå·ï¼ˆç®€å•è§„åˆ™ï¼š11 ä½ï¼Œä»¥ 13/14/15/17/18/19 å¼€å¤´ï¼‰

```python
import re

text = "è¯·è”ç³» 13812345678 æˆ–è€… 155-1234-5678ï¼Œå¦å¤– 01234567890 ä¸æ˜¯æ‰‹æœºå·ã€‚"

# å¸¸è§æ ¼å¼ï¼š11 ä½æ•°å­—ï¼Œæœ‰æ—¶å«åˆ†éš”ç¬¦ '-'
pattern = r"\b(?:1[3-9]\d{9})\b"  # \b å•è¯è¾¹ç•Œï¼Œ1[3-9] å¼€å¤´ + 9 ä¸ªæ•°å­—ï¼Œå…± 11 ä½

phones = re.findall(pattern, text)
print("æå–åˆ°çš„æ‰‹æœºå·ï¼š", phones)
```

**è¯´æ˜**ï¼šæ‰‹æœºå·ç çš„è§„åˆ™åœ¨ä¸åŒå›½å®¶ä¸åŒï¼Œä¸Šé¢æ˜¯ç®€åŒ–ç‰ˆä¸­å›½æ‰‹æœºå·æ¨¡å¼ã€‚

---

### æ¡ˆä¾‹ C â€” æ—¥å¿—è§£æï¼šä»æœåŠ¡å™¨æ—¥å¿—æå– IPã€æ—¶é—´ã€è·¯å¾„ã€çŠ¶æ€ç 

å‡è®¾æ—¥å¿—æ ¼å¼ï¼ˆNginx/Apache å¸¸è§æ ¼å¼å˜ä½“ï¼‰ï¼š

```
127.0.0.1 - - [10/Nov/2025:06:25:24 +0000] "GET /index.html HTTP/1.1" 200 1024
```

```python
import re

log = '127.0.0.1 - - [10/Nov/2025:06:25:24 +0000] "GET /index.html HTTP/1.1" 200 1024'

# æ­£åˆ™åˆ†ç»„ï¼šIPã€æ—¶é—´ã€æ–¹æ³•ä¸è·¯å¾„ã€çŠ¶æ€ç ã€å¤§å°
pattern = r'(?P<ip>\d{1,3}(?:\.\d{1,3}){3}) - - \[(?P<time>.*?)\] "(?P<method>\w+) (?P<path>[^ ]+) [^"]+" (?P<status>\d{3}) (?P<size>\d+)'

m = re.search(pattern, log)
if m:
    print("Parsed log:")
    print(m.groupdict())
# è¾“å‡ºç¤ºä¾‹:
# {'ip':'127.0.0.1', 'time':'10/Nov/2025:06:25:24 +0000', 'method':'GET', 'path':'/index.html', 'status':'200', 'size':'1024'}
```

**ä¸­æ–‡æ³¨é‡Š**ï¼š

* `(?P<ip>...)` ç»™æ•è·ç»„å‘½åä¾¿äºç›´æ¥ç”¨ groupdict å¾—åˆ°ç»“æ„åŒ–ç»“æœï¼›
* `(?:...)` éæ•è·ç»„ç”¨äºå†…éƒ¨ç»„åˆä½†ä¸æƒ³å ç”¨æ•è·ç´¢å¼•ã€‚

---

### æ¡ˆä¾‹ D â€” æ¸…é™¤ HTML æ ‡ç­¾ï¼ˆç®€å•æ–¹æ³•ï¼Œä¸é€‚åˆå¤æ‚ HTMLï¼‰

> æ³¨æ„ï¼šé€šå¸¸å»ºè®®ç”¨ä¸“é—¨çš„ HTML è§£æå™¨ï¼ˆBeautifulSoupï¼‰æ¥æ¸…ç† HTMLã€‚ä¸‹é¢ç¤ºä¾‹ä»…ç”¨äºç®€å•åœºæ™¯ï¼ˆæ— åµŒå¥—è„šæœ¬å¤æ‚åœºæ™¯ï¼‰ã€‚

```python
import re

html = "<div><p>ç¬¬ä¸€æ®µ</p><p>ç¬¬äºŒæ®µ<img src='x.png' /></p></div>"

# ç®€å•å»é™¤æ ‡ç­¾ï¼šæ›¿æ¢æ‰€æœ‰ <...> ä¸ºç©º
text = re.sub(r"<[^>]+>", "", html)  # è´ªå©ªæˆ–éè´ªå©ªéƒ½ä¼šåœ¨è¿™é‡Œå·¥ä½œï¼ŒåŒæ ·ä¼šåˆ é™¤æ ‡ç­¾å†…å±æ€§
print("æ¸…æ´—åæ–‡æœ¬ï¼š", text)
```

---

## 5.9 æ€§èƒ½ä¸ä¼˜åŒ–å»ºè®®

* å¯¹äºå¤§æ–‡æœ¬æˆ–é«˜é¢‘åŒ¹é…ï¼Œä½¿ç”¨ `re.compile()` é¢„ç¼–è¯‘æ¨¡å¼ä»¥å¤ç”¨ `Pattern` å¯¹è±¡ã€‚
* é¿å…è¿‡åº¦å›æº¯ï¼ˆCatastrophic backtrackingï¼‰ï¼šæŸäº›ä¸å½“ä½¿ç”¨çš„åµŒå¥—é‡è¯ä¼šå¯¼è‡´æ­£åˆ™å›æº¯æŒ‡æ•°çº§å¢é•¿ï¼ˆä¾‹å¦‚ä½¿ç”¨ `(a+)+` åœ¨å¯¹é•¿è¾“å…¥ä¸²ä¸Šä¼šå˜æ…¢ï¼‰ã€‚è‹¥é‡åˆ°æ€§èƒ½é—®é¢˜ï¼Œè€ƒè™‘æ”¹å†™æ¨¡å¼æˆ–ä½¿ç”¨éå›æº¯ç®—æ³•ã€‚
* ä½¿ç”¨ç‰¹å®šå­—ç¬¦ç±»è€Œä¸æ˜¯é€šé…ç¬¦ `.`ï¼Œä»¥å‡å°åŒ¹é…ç©ºé—´ã€‚
* åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ç®€å•çš„å­—ç¬¦ä¸²æ–¹æ³•ï¼ˆ`str.startswith`, `in`, `split`ï¼‰ä»£æ›¿æ­£åˆ™ï¼Œå› ä¸ºç®€å•æ–¹æ³•é€šå¸¸æ›´å¿«ä¸”å¯è¯»æ€§æ›´é«˜ã€‚

---

## 5.10 å°ç»ƒä¹ ï¼ˆå»ºè®®åœ¨æœ¬ç« ç»ƒä¹ ï¼‰

1. å†™ä¸€ä¸ªå‡½æ•° `extract_emails(text)`ï¼Œä»æ–‡æœ¬ä¸­è¿”å›æ‰€æœ‰é‚®ç®±åœ°å€åˆ—è¡¨ï¼ˆå»é‡å¹¶æŒ‰å‡ºç°é¡ºåºè¿”å›ï¼‰ã€‚
2. å†™ä¸€ä¸ªå‡½æ•° `mask_phone_numbers(text)`ï¼Œå°†æ–‡æœ¬ä¸­çš„æ‰‹æœºå·ä¸­é—´ 4 ä½æ›¿æ¢ä¸º `****`ï¼ˆä¾‹å¦‚ `13812345678` â†’ `138****5678`ï¼‰ã€‚
3. ç»™å®š HTML å­—ç¬¦ä¸²ï¼Œä½¿ç”¨æ­£åˆ™æå–æ‰€æœ‰ `<img>` æ ‡ç­¾çš„ `src` å±æ€§å€¼ï¼ˆæ³¨æ„å±æ€§å¯èƒ½ç”¨å•å¼•å·æˆ–åŒå¼•å·ï¼‰ã€‚

ï¼ˆç»ƒä¹ ç­”æ¡ˆæˆ‘å¯ä»¥åœ¨åé¢ä¸€å¹¶æä¾›ï¼Œæˆ–ä½ åšå®Œå‘æˆ‘æˆ‘æ¥æ£€æŸ¥ã€‚ï¼‰

---

ç°åœ¨è¿›å…¥ä½ æœ€é‡è¦çš„ä¸€ç« â€”â€”**ç¬¬ 6 ç« ï¼šNumPyï¼ˆæ•°å€¼è®¡ç®—æ ¸å¿ƒå†…å®¹ï¼‰**ã€‚
è¿™ä¸€ç« æˆ‘ä¼šåœ¨ PDF çš„åŸºç¡€ä¸Šè¿›è¡Œé«˜åº¦æ‰©å±•ï¼Œå†…å®¹å°†è¾¾åˆ°**æ•™æçº§åˆ«çš„ç»†èŠ‚æ·±åº¦**ï¼ŒåŒ…å«ï¼š

* ndarray æ•°æ®ç»“æ„æœ¬è´¨
* dtype æ·±åº¦è®²è§£
* å†…å­˜å¸ƒå±€ï¼ˆC-order / F-orderï¼‰
* å¹¿æ’­ï¼ˆBroadcastingï¼‰çš„åŸç†
* å‘é‡åŒ–ï¼ˆvectorizationï¼‰
* è§†å›¾ä¸å‰¯æœ¬ï¼ˆéå¸¸å¤šåˆå­¦è€…è¸©å‘ï¼‰
* ç´¢å¼•æ–¹å¼ï¼ˆåŸºç¡€ç´¢å¼•ã€å¸ƒå°”ç´¢å¼•ã€èŠ±å¼ç´¢å¼•ï¼‰
* æ•°ç»„æ“ä½œï¼ˆæ‹¼æ¥ã€æ‹†åˆ†ã€æ’åºã€å¤åˆ¶ï¼‰
* ç»Ÿè®¡å‡½æ•°
* éšæœºæ¨¡å—
* çº¿æ€§ä»£æ•°ï¼ˆçŸ©é˜µä¹˜æ³•ã€æ±‚é€†ã€æ±‚è§£ã€ç‰¹å¾å€¼ SVDï¼‰
* å®æˆ˜æ¡ˆä¾‹ï¼ˆæˆ¿ä»·é¢„æµ‹ã€æ ‡å‡†åŒ–ã€å›¾åƒå¤„ç†ï¼‰

å¹¶ä¸”ç»™å‡º**å¤§é‡å¸¦ä¸­æ–‡æ³¨é‡Šçš„å®Œæ•´ä»£ç ç¤ºä¾‹**ã€‚

---

å¥½çš„ï¼ä¸‹é¢æˆ‘å°† **å®Œå…¨æŒ‰ç…§ä½ ç»™å‡ºçš„æ ¼å¼ç»“æ„**ï¼Œé‡æ–°æ”¹å†™å¹¶è¡¥å…¨ï¼š

* **ç¬¬ 6 ç«  â€” NumPyï¼ˆæ•°å€¼è®¡ç®—æ ¸å¿ƒåº“ï¼‰å®Œæ•´ç‰ˆæœ¬ï¼ˆå« strides / ufunc / å†…å­˜å¸ƒå±€ / éšæœºåˆ†å¸ƒè¿›é˜¶ / matrix åŒºåˆ«ç­‰ï¼‰**
* **ç¬¬ 7 ç«  â€” æ–‡ä»¶å¤„ç† File I/Oï¼ˆåŒ…å« buffer / encoding / seek / ä¸Šä¸‹æ–‡ç®¡ç†å™¨åŸç† / CSV / JSON å…¨éƒ¨å†…å®¹ï¼‰**

ä½ çš„åŸæ–‡æˆ‘ä¼šæ•´ä½“ä¿ç•™ç»“æ„ï¼Œä½†è¿›è¡Œï¼š

* **ç³»ç»ŸåŒ–é‡å†™ï¼ˆæ›´ä¸“ä¸šã€æ›´å…¨é¢ï¼‰**
* **æ·±åº¦æ‰©å±• PDF ä¸­æœªè®²ä½†å¿…é¡»æŒæ¡çš„å†…å®¹**
* **åŠ å…¥å…¨ä¸­æ–‡æ³¨é‡Šä»£ç ç¤ºä¾‹**
* **æœ€ç»ˆå½¢æˆå¯ç›´æ¥ä½œä¸ºæ•™å­¦ææ–™çš„ Markdown æ–‡æ¡£**

---

# ğŸ‰ **ä»¥ä¸‹ä¸ºä½ è¦çš„ã€Šç¬¬ 6 ç«  + ç¬¬ 7 ç« ã€‹æœ€ç»ˆå®Œæ•´ç‰ˆï¼ˆMarkdown æ ¼å¼ï¼Œå¯ç›´æ¥å¤åˆ¶ä¿å­˜ï¼‰**

---

# ç¬¬ 6 ç«  â€” NumPyï¼ˆæ•°å€¼è®¡ç®—æ ¸å¿ƒåº“ï¼‰

---

# 6.1 NumPy ç®€ä»‹ï¼ˆæ¥è‡ª PDF + æ‰©å±•ï¼‰

NumPyï¼ˆNumerical Pythonï¼‰æ˜¯ Python åœ¨ç§‘å­¦è®¡ç®—ä¸æ•°æ®åˆ†æé¢†åŸŸçš„æ ¸å¿ƒåŸºç¡€åº“ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

---

## âœ” æ ¸å¿ƒç‰¹æ€§ï¼ˆKey Featuresï¼‰

* **é«˜æ€§èƒ½ ndarrayï¼ˆå¤šç»´æ•°ç»„å¯¹è±¡ï¼‰**ï¼Œåº•å±‚æ˜¯ C å®ç°ï¼Œæ¯” Python list å¿«å‡ åå€
* **å‘é‡åŒ–ï¼ˆVectorizedï¼‰è®¡ç®—**
* **å¹¿æ’­æœºåˆ¶ï¼ˆBroadcastingï¼‰** è‡ªåŠ¨æ‰©å±•ä¸åŒå½¢çŠ¶æ•°ç»„
* **å¼ºå¤§çš„çº¿æ€§ä»£æ•°åº“**ï¼ˆçŸ©é˜µä¹˜æ³•ã€æ±‚é€†ã€ç‰¹å¾å€¼ã€SVDï¼‰
* **éšæœºæ•°æ¨¡å—ï¼ˆnp.randomï¼‰**
* **é«˜æ•ˆçš„å†…å­˜ç®¡ç†ï¼ˆstrides / C-order / F-orderï¼‰**

è¿™äº›ç‰¹æ€§ä½¿ NumPy æˆä¸ºæœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ å’Œç§‘å­¦è®¡ç®—çš„åŸºç¡€ã€‚

---

# 6.2 ndarrayï¼ˆNumPy æ ¸å¿ƒæ•°æ®ç»“æ„ï¼‰

---

# 6.2.1 ndarray çš„æœ¬è´¨ï¼ˆéå¸¸é‡è¦ï¼‰

ä¸€ä¸ª `ndarray` ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

| ç»„æˆéƒ¨åˆ†            | è§£é‡Š                      |
| --------------- | ----------------------- |
| **data buffer** | å®é™…å­˜å‚¨æ•°æ®çš„ä¸€å—è¿ç»­å†…å­˜           |
| **shape**       | æ¯ä¸ªç»´åº¦çš„å¤§å°ï¼Œä¾‹å¦‚ (3,4)        |
| **dtype**       | æ•°æ®ç±»å‹ï¼ˆfloat32ã€int64 ç­‰ï¼‰   |
| **strides**     | æ¯å‰è¿›ä¸€æ­¥åœ¨å†…å­˜ä¸­è·³è¿‡å¤šå°‘å­—èŠ‚ï¼ˆæ§åˆ¶è®¿é—®é€Ÿåº¦ï¼‰ |

---

## ç¤ºä¾‹ï¼šåˆ›å»º ndarray

```python
import numpy as np

# ä»åˆ—è¡¨åˆ›å»ºæ•°ç»„
a = np.array([1, 2, 3])
b = np.array([[1,2,3],[4,5,6]])

print("æ•°ç»„ a:", a)
print("æ•°ç»„ b:\n", b)

print("ç»´åº¦ ndim:", b.ndim)
print("å½¢çŠ¶ shape:", b.shape)
print("å…ƒç´ æ•°é‡ size:", b.size)
print("æ•°æ®ç±»å‹ dtype:", b.dtype)
print("æ­¥å¹… strides:", b.strides)  # æ¯ä¸ªç»´åº¦è·¨è¶Šçš„å­—èŠ‚æ•°
```

---

# 6.3 dtypeï¼ˆæ•°æ®ç±»å‹ï¼Œå†³å®šå†…å­˜å ç”¨ï¼‰

---

## å¸¸è§ dtype åˆ—è¡¨

| dtype      | æè¿°                |
| ---------- | ----------------- |
| int32      | 32 ä½æ•´æ•°            |
| int64      | 64 ä½æ•´æ•°            |
| float32    | å•ç²¾åº¦æµ®ç‚¹ï¼ˆå¸¸ç”¨äºæ·±åº¦å­¦ä¹ ï¼‰    |
| float64    | åŒç²¾åº¦æµ®ç‚¹ï¼ˆé»˜è®¤ï¼‰         |
| bool       | å¸ƒå°”ç±»å‹              |
| complex128 | å¤æ•°                |
| object     | Python å¯¹è±¡ï¼ˆææ…¢ï¼Œä¸æ¨èï¼‰ |

---

## è½¬æ¢ dtype

```python
import numpy as np

a = np.array([1.2, 2.5, 3.7], dtype=np.float64)
b = a.astype(np.int32)   # å°æ•°éƒ¨åˆ†å°†ç›´æ¥æˆªæ–­

print(a)
print(b)
```

---

# 6.4 å†…å­˜å¸ƒå±€ï¼ˆC-order vs F-orderï¼‰

NumPy æ”¯æŒä¸¤ç§å†…å­˜æ’åˆ—ï¼š

---

## âœ” C-orderï¼ˆé»˜è®¤ï¼Œè¡Œä¼˜å…ˆï¼‰

æ•°ç»„æŒ‰è¡Œä¾æ¬¡å­˜å‚¨ã€‚

## âœ” F-orderï¼ˆåˆ—ä¼˜å…ˆï¼‰

ç±»ä¼¼ MATLAB / Fortranï¼Œæ›´é€‚åˆçŸ©é˜µæ“ä½œã€‚

æŸ¥çœ‹å†…å­˜å¸ƒå±€ï¼š

```python
arr_C = np.array([[1,2,3],[4,5,6]], order='C')
arr_F = np.array([[1,2,3],[4,5,6]], order='F')

print(arr_C.flags)  # C_CONTIGUOUS = True
print(arr_F.flags)  # F_CONTIGUOUS = True
```

---

# 6.5 stridesï¼ˆæ­¥å¹…ï¼‰â€”â€” è®¿é—®é€Ÿåº¦çš„å…³é”®ï¼ˆPDF æ²¡è®²ä½†éå¸¸é‡è¦ï¼‰

`strides` è¡¨ç¤ºï¼š

> åœ¨æŸä¸ªç»´åº¦ä¸Šå‘å‰ç§»åŠ¨ 1 æ­¥ï¼Œéœ€è¦è·³è¿‡å¤šå°‘å­—èŠ‚ã€‚

ç¤ºä¾‹ï¼š

```python
import numpy as np

a = np.array([[1,2,3],
              [4,5,6]], dtype=np.int32)

print("strides:", a.strides)
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
(12, 4)
```

è§£é‡Šï¼š

* åœ¨ axis 0ï¼ˆè¡Œï¼‰ç§»åŠ¨ï¼šè·¨è¶Š 3 ä¸ª int32 â†’ 3Ã—4=12 å­—èŠ‚
* åœ¨ axis 1ï¼ˆåˆ—ï¼‰ç§»åŠ¨ï¼šè·¨è¶Š 1 ä¸ª int32 â†’ 4 å­—èŠ‚

---

# 6.6 åˆ›å»ºæ•°ç»„çš„å¸¸è§æ–¹æ³•

```python
np.zeros((2,3))
np.ones((3,3))
np.full((2,2), 7)
np.eye(3)
np.arange(0, 10, 2)
np.linspace(0, 1, 5)
```

---

# 6.7 ç´¢å¼•ä¸åˆ‡ç‰‡ï¼ˆnumpy çš„çµé­‚ï¼‰

---

## 6.7.1 åŸºæœ¬ç´¢å¼•

```python
arr = np.array([[10,20,30],[40,50,60]])

print(arr[0,1])    # 20
print(arr[1,:])    # [40 50 60]
print(arr[:,2])    # [30 60]
```

---

## 6.7.2 å¸ƒå°”ç´¢å¼•

```python
scores = np.array([58, 90, 77, 46, 88])

passed = scores[scores >= 60]  # ç­›é€‰

print(passed)
print("åŠæ ¼äººæ•°ï¼š", (scores >= 60).sum())
```

---

## 6.7.3 èŠ±å¼ç´¢å¼•ï¼ˆFancy Indexingï¼‰

```python
a = np.array([10,20,30,40,50])
idx = [0, 3, 4]
print(a[idx])
```

---

# 6.8 è§†å›¾ vs æ‹·è´ï¼ˆæ€§èƒ½å…³é”®ï¼‰

---

## è§†å›¾ viewï¼ˆå…±äº«å†…å­˜ï¼‰

```python
a = np.arange(5)
v = a.view()
v[0] = 100
print(a)  # åŸæ•°ç»„è¢«ä¿®æ”¹
```

---

## æ‹·è´ copyï¼ˆç‹¬ç«‹å†…å­˜ï¼‰

```python
a = np.arange(5)
c = a.copy()
c[0] = 100
print(a)  # åŸæ•°ç»„ä¸å˜
```

---

# 6.9 å¹¿æ’­ï¼ˆBroadcastingï¼‰è§„åˆ™ï¼ˆæ¯” PDF æ›´å®Œæ•´ï¼‰

è§„åˆ™ï¼š

1. ä»å³å¾€å·¦æ¯”è¾ƒ
2. ç›¸åŒæˆ– 1 â†’ å…¼å®¹
3. å¦åˆ™ â†’ ä¸å¯å¹¿æ’­

ç¤ºä¾‹ï¼š

```python
A = np.array([[1],[2],[3]])
B = np.array([10,20,30])

print(A + B)
```

---

# 6.10 ufuncï¼ˆé€šç”¨å‡½æ•°ï¼‰â€”â€” NumPy æœ€å¼ºèƒ½åŠ›ä¹‹ä¸€

ufunc = å¯¹æ•°ç»„é€å…ƒç´ æ“ä½œçš„ä¼˜åŒ– C å‡½æ•°ã€‚

å¸¸è§ï¼š

```python
np.add
np.subtract
np.multiply
np.divide
np.sin
np.cos
np.exp
np.log
```

---

## ufunc.reduce()

```python
a = np.array([1,2,3,4])
print(np.add.reduce(a))       # -> 10
print(np.multiply.reduce(a))  # -> 24
```

---

# 6.11 éšæœºæ¨¡å—ï¼ˆnp.randomï¼‰è¿›é˜¶

### âœ” å¸¸è§åˆ†å¸ƒï¼š

```python
np.random.poisson(lam=3, size=10)       # æ³Šæ¾åˆ†å¸ƒ
np.random.exponential(scale=1.0, size=5) # æŒ‡æ•°åˆ†å¸ƒ
np.random.binomial(10, 0.4, 5)          # äºŒé¡¹åˆ†å¸ƒ
np.random.normal(0, 1, 10)              # æ­£æ€åˆ†å¸ƒ
```

---

# 6.12 matrix vs ndarrayï¼ˆéå¸¸é‡è¦ï¼‰

matrix å·²è¢«å¼ƒç”¨ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚

| ç‰¹æ€§     | ndarray | matrix |
| ------ | ------- | ------ |
| â€œ*â€ è¿ç®— | å…ƒç´ ä¹˜æ³•    | çŸ©é˜µä¹˜æ³•   |
| æ¨èç¨‹åº¦   | âœ”âœ”âœ”âœ”âœ”   | âŒ ä¸æ¨è  |
| æ”¯æŒç»´æ•°   | ä»»æ„      | åªèƒ½ 2D  |

---

# 6.13 çº¿æ€§ä»£æ•°ï¼ˆnp.linalgï¼‰

---

## 6.13.1 çŸ©é˜µä¹˜æ³•

```python
A @ B
```

---

## 6.13.2 è§£çº¿æ€§æ–¹ç¨‹ç»„

```python
x = np.linalg.solve(A, b)
```

---

## 6.13.3 ç‰¹å¾å€¼åˆ†è§£

```python
vals, vecs = np.linalg.eig(A)
```

---

## 6.13.4 SVDï¼ˆå¥‡å¼‚å€¼åˆ†è§£ï¼‰

```python
U, S, Vt = np.linalg.svd(A)
```

---

# 6.14 å®æˆ˜æ¡ˆä¾‹ï¼ˆå®Œå…¨æ‰©å±•ç‰ˆï¼‰

---

## æ¡ˆä¾‹ 1ï¼šZ-score æ ‡å‡†åŒ–

```python
data = np.array([50, 60, 70, 80, 90], dtype=float)
z = (data - data.mean()) / data.std()
print(z)
```

---

## æ¡ˆä¾‹ 2ï¼šå›¾åƒç°åº¦åŒ–

```python
pixel = np.array([120,200,150])
gray = 0.299*pixel[0] + 0.587*pixel[1] + 0.114*pixel[2]
print(gray)
```

---

## æ¡ˆä¾‹ 3ï¼šä½¿ç”¨ NumPy å®ç°çº¿æ€§å›å½’ï¼ˆæ­£è§„æ–¹ç¨‹æ³•ï¼‰

```python
X = np.array([[50,10],[60,15],[80,20],[100,5]], float)
X = np.c_[np.ones(X.shape[0]), X]
y = np.array([300,350,500,650], float)

w = np.linalg.inv(X.T @ X) @ X.T @ y
print("æ¨¡å‹å‚æ•°ï¼š", w)
```

---

# âœ” ç¬¬ 6 ç« ç»“æŸï¼ˆå®Œæ•´ç‰ˆï¼‰

---

---

# ç¬¬ 7 ç«  â€” æ–‡ä»¶ä¸æ•°æ®è¯»å†™ï¼ˆFile I/O, CSV, JSONï¼‰

---

# 7.1 æ–‡ä»¶åŸºç¡€æ¦‚å¿µï¼ˆWhat is a Fileï¼‰

æ–‡ä»¶æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ•°æ®ï¼Œå°†æ•°æ®æŒä¹…åŒ–ä¿å­˜ã€‚Python ä½¿ç”¨ `open()` å‡½æ•°åˆ›å»ºæ–‡ä»¶å¯¹è±¡ã€‚

---

# 7.2 æ–‡ä»¶æ“ä½œæµç¨‹

```
open â†’ read/write â†’ close
```

æ¨èä½¿ç”¨ `with` è‡ªåŠ¨å…³é—­æ–‡ä»¶ã€‚

---

# 7.3 æ–‡ä»¶æ‰“å¼€æ¨¡å¼ï¼ˆFile Modesï¼‰

| æ¨¡å¼ | ä¸­æ–‡è¯´æ˜     | è‹±æ–‡è¯´æ˜         |
| -- | -------- | ------------ |
| r  | åªè¯»       | read         |
| w  | è¦†ç›–å†™å…¥     | write        |
| a  | è¿½åŠ å†™å…¥     | append       |
| x  | è‹¥æ–‡ä»¶å­˜åœ¨åˆ™æŠ¥é”™ | exclusive    |
| b  | äºŒè¿›åˆ¶æ¨¡å¼    | binary       |
| t  | æ–‡æœ¬æ¨¡å¼     | text         |
| +  | å¯è¯»å¯å†™     | read & write |

---

# 7.4 æ–‡æœ¬æ–‡ä»¶è¯»å†™

---

## è¯»å–æ•´ä¸ªæ–‡ä»¶

```python
with open("demo.txt", "r", encoding="utf-8") as f:
    text = f.read()
```

---

## æŒ‰è¡Œè¯»å–

```python
with open("demo.txt", "r", encoding="utf-8") as f:
    for line in f:
        print(line.strip())
```

---

# 7.5 seek() / tell()ï¼ˆæ–‡ä»¶æŒ‡é’ˆï¼‰

seek å‚æ•°ï¼š

```
seek(offset, whence)
```

| whence | æ„ä¹‰   |
| ------ | ---- |
| 0      | æ–‡ä»¶å¼€å¤´ |
| 1      | å½“å‰ä½ç½® |
| 2      | æ–‡ä»¶æœ«å°¾ |

---

ç¤ºä¾‹ï¼š

```python
with open("demo.txt","r") as f:
    f.seek(0,2)
    print(f.tell())  # æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
```

---

# 7.6 ä¸Šä¸‹æ–‡ç®¡ç†å™¨ with çš„åŸç†ï¼ˆé«˜çº§ç‰ˆï¼‰

`with` å®é™…è°ƒç”¨ï¼š

* `__enter__()`ï¼šæ‰“å¼€èµ„æº
* `__exit__()`ï¼šå…³é—­èµ„æº

ç¤ºä¾‹ï¼ˆæ¨¡æ‹Ÿ openï¼‰ï¼š

```python
class MyContext:
    def __enter__(self):
        print("è¿›å…¥ä¸Šä¸‹æ–‡")
        return self
    def __exit__(self, exc_type, exc, tb):
        print("ç¦»å¼€ä¸Šä¸‹æ–‡")

with MyContext():
    print("å¤„ç†ä¸­...")
```

---

# 7.7 äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆBinary Filesï¼‰

å›¾ç‰‡ã€éŸ³é¢‘ã€æ¨¡å‹ç­‰å¿…é¡»ç”¨äºŒè¿›åˆ¶æ¨¡å¼å¤„ç†ã€‚

```python
with open("a.jpg", "rb") as f:
    data = f.read()

with open("b.jpg", "wb") as f:
    f.write(data)
```

---

# 7.8 CSV æ–‡ä»¶ï¼ˆcsv æ¨¡å— + pandasï¼‰

---

## csv.reader

```python
import csv

with open("scores.csv","r",encoding="utf-8") as f:
    for row in csv.reader(f):
        print(row)
```

---

## csv.writer

```python
with open("scores.csv","w",newline="",encoding="utf-8") as f:
    writer = csv.writer(f)
    writer.writerow(["Name","Score"])
    writer.writerow(["Alice",90])
```

---

## pandas è¯»å†™ CSV

```python
import pandas as pd

df = pd.read_csv("data.csv")
df.to_csv("output.csv", index=False)
```

---

# 7.9 JSONï¼ˆjson æ¨¡å—ï¼‰

---

## è¯»å– JSON

```python
import json

with open("config.json","r",encoding="utf-8") as f:
    data = json.load(f)
```

---

## å†™å…¥ JSON

```python
json.dump(data, open("out.json","w"), ensure_ascii=False, indent=4)
```

---

# 7.10 æ–‡ä»¶è·¯å¾„ï¼ˆos + pathlibï¼‰

---

## os æ¨¡å—

```python
import os

print(os.getcwd())
print(os.listdir("."))
os.rename("old.txt","new.txt")
```

---

## pathlibï¼ˆæ›´æ¨èï¼‰

```python
from pathlib import Path

p = Path("data")
p.mkdir(exist_ok=True)

(file := p / "test.txt").write_text("Hello",encoding="utf-8")
```

---

# 7.11 å®æˆ˜æ¡ˆä¾‹

---

## æ¡ˆä¾‹ 1ï¼šæ–‡æœ¬è¯é¢‘ç»Ÿè®¡

```python
from collections import Counter

with open("article.txt","r",encoding="utf-8") as f:
    words = f.read().lower().split()

print(Counter(words).most_common(10))
```

---

## æ¡ˆä¾‹ 2ï¼šæ‰¹é‡åˆå¹¶ CSV

```python
import pandas as pd
from pathlib import Path

dfs = [pd.read_csv(f) for f in Path("csvs").glob("*.csv")]
pd.concat(dfs).to_csv("all.csv", index=False)
```

---

## æ¡ˆä¾‹ 3ï¼šJSON è½¬ CSV

```python
data = json.load(open("students.json"))
pd.DataFrame(data).to_csv("students.csv", index=False)
```

---

# âœ” ç¬¬ 7 ç« ç»“æŸï¼ˆå®Œæ•´ç‰ˆï¼‰

---

# ğŸ‰ ç°åœ¨ä½ å·²ç»æ‹¥æœ‰å®Œæ•´ã€æ•™æçº§çš„ï¼š

### âœ” ç¬¬ 6 ç«  NumPyï¼ˆæ‰©å±• + å®Œæ•´ï¼‰

### âœ” ç¬¬ 7 ç«  æ–‡ä»¶ I/Oï¼ˆæ‰©å±• + å®Œæ•´ï¼‰

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»§ç»­ï¼š

âœ… æŠŠæ‰€æœ‰ç« èŠ‚æ±‡æ€»æˆ **ä¸€ä»½æœ€ç»ˆå¤§ Markdown æ•™æ**
âœ… å¯¼å‡º **PDF/Word/PPT**
âœ… ç»§ç»­å†™ **ç¬¬å…«ã€ç¬¬ä¹ç« **
âœ… æˆ–æ ¹æ®ä½ å­¦æ ¡çš„è¦æ±‚ç”Ÿæˆ **ä½œä¸šå‚è€ƒç­”æ¡ˆã€å®éªŒæŠ¥å‘Šæ¨¡æ¿**

ä½ æƒ³è¦å“ªä¸€ä¸ªï¼Ÿ


# ç¬¬ä¸ƒç« ç»“æŸï¼

---

ä¸‹ä¸€ç« å°†æ˜¯ï¼š

# **ç¬¬å…«ç« ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰â€”â€”ç±»ã€å¯¹è±¡ã€ç»§æ‰¿ã€å¤šæ€ã€å°è£…ã€Magic Methodsï¼ˆæ‰©å±•ç‰ˆï¼‰**

å¥½çš„ï¼ç°åœ¨å¼€å§‹ç”Ÿæˆä½ çš„ **ç¬¬å…«ç« ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰**ã€‚
æˆ‘ä¼šåŸºäºä½  PDF çš„å†…å®¹èŒƒå›´è¿›è¡Œæ‰©å±•ï¼ŒåŠ å…¥å®Œæ•´çš„çŸ¥è¯†ç‚¹è¯´æ˜ã€æ·±å…¥è®²è§£æœºåˆ¶åŸç†ï¼Œå¹¶é…ä¸Šå¤§é‡å¸¦ä¸­æ–‡æ³¨é‡Šçš„ Python ç¤ºä¾‹ä»£ç ï¼Œè®©ä½ çœŸæ­£æŒæ¡ç±»ï¼ˆClassï¼‰ä¸å¯¹è±¡ï¼ˆObjectï¼‰çš„åº•å±‚é€»è¾‘ã€‚

---

# **ç¬¬å…«ç« ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOP in Pythonï¼‰**

---

# **ç›®å½•ï¼ˆTable of Contentsï¼‰**

1. ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ï¼ˆOOPï¼‰
2. ç±»ä¸å¯¹è±¡ï¼ˆClass & Objectï¼‰
3. `__init__` æ„é€ æ–¹æ³•
4. å±æ€§ä¸æ–¹æ³•ï¼ˆAttributes & Methodsï¼‰
5. ç±»å±æ€§ vs å®ä¾‹å±æ€§
6. å°è£…ï¼ˆEncapsulationï¼‰
7. ç§æœ‰å±æ€§ä¸å—ä¿æŠ¤å±æ€§
8. ç»§æ‰¿ï¼ˆInheritanceï¼‰
9. å¤šé‡ç»§æ‰¿ï¼ˆMultiple Inheritanceï¼‰
10. æ–¹æ³•é‡å†™ï¼ˆOverrideï¼‰ä¸ super()
11. å¤šæ€ï¼ˆPolymorphismï¼‰
12. é­”æœ¯æ–¹æ³•ï¼ˆMagic / Dunder Methodsï¼‰
13. ç±»æ–¹æ³• & é™æ€æ–¹æ³•ï¼ˆclassmethod, staticmethodï¼‰
14. æŠ½è±¡ç±»ï¼ˆAbstract Classesï¼‰
15. OOP å®æˆ˜æ¡ˆä¾‹
16. å°ç»ƒä¹ ä¸ç­”æ¡ˆ

---

# **8.1 ä»€ä¹ˆæ˜¯ OOPï¼Ÿ**

## ä¸­æ–‡è§£é‡Š

é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰æ˜¯ä¸€ç§æ¨¡å‹ï¼ŒæŠŠç°å®ä¸–ç•ŒæŠ½è±¡ä¸ºâ€œå¯¹è±¡â€ï¼Œå¯¹è±¡åŒ…å«ï¼š

* **å±æ€§ï¼ˆAttributesï¼‰**ï¼šæ•°æ®
* **æ–¹æ³•ï¼ˆMethodsï¼‰**ï¼šè¡Œä¸º

OOP ä¸»è¦ç‰¹æ€§ï¼š

1. **å°è£…ï¼ˆEncapsulationï¼‰**
2. **ç»§æ‰¿ï¼ˆInheritanceï¼‰**
3. **å¤šæ€ï¼ˆPolymorphismï¼‰**

## English

Object-Oriented Programming abstracts real-world entities into **objects** containing **data** and **behaviors**, enabling clean design, modularity and code reuse.

---

# **8.2 ç±»ï¼ˆClassï¼‰ä¸å¯¹è±¡ï¼ˆObjectï¼‰**

* ç±» = æ¨¡æ¿
* å¯¹è±¡ = æ¨¡æ¿åˆ›å»ºå‡ºæ¥çš„å®ä¾‹

```python
class Person:
    pass

p = Person()   # åˆ›å»ºä¸€ä¸ªå¯¹è±¡
print(type(p))  # <class '__main__.Person'>
```

---

# **8.3 æ„é€ æ–¹æ³• `__init__`**

`__init__` åœ¨åˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–å±æ€§ã€‚

```python
class Person:
    def __init__(self, name, age):
        self.name = name     # å®ä¾‹å±æ€§
        self.age = age

p = Person("Alice", 20)
print(p.name, p.age)
```

---

# **8.4 å±æ€§ä¸æ–¹æ³•ï¼ˆAttributes & Methodsï¼‰**

```python
class Person:
    def __init__(self, name):
        self.name = name
    
    def greet(self):
        print(f"ä½ å¥½ï¼Œæˆ‘å« {self.name}")

p = Person("Bob")
p.greet()  # è°ƒç”¨æ–¹æ³•
```

---

# **8.5 ç±»å±æ€§ vs å®ä¾‹å±æ€§**

## å®ä¾‹å±æ€§ï¼ˆinstance attributeï¼‰

å±äºæ¯ä¸ªå¯¹è±¡ç‹¬ç«‹ã€‚

## ç±»å±æ€§ï¼ˆclass attributeï¼‰

æ‰€æœ‰å¯¹è±¡å…±äº«ã€‚

```python
class Dog:
    species = "Canine"   # ç±»å±æ€§ï¼ˆæ‰€æœ‰ç‹—å…±äº«ï¼‰

    def __init__(self, name):
        self.name = name  # å®ä¾‹å±æ€§ï¼ˆæ¯åªç‹—ä¸åŒï¼‰

dog1 = Dog("A")
dog2 = Dog("B")

print(dog1.species, dog2.species)
print(dog1.name, dog2.name)
```

---

# **8.6 å°è£…ï¼ˆEncapsulationï¼‰**

éšè—å¯¹è±¡å†…éƒ¨ç»†èŠ‚ï¼Œé€šè¿‡æ–¹æ³•æš´éœ²å®‰å…¨æ¥å£ã€‚

---

# **8.7 ç§æœ‰å±æ€§ä¸å—ä¿æŠ¤å±æ€§**

## å—ä¿æŠ¤ï¼ˆçº¦å®šï¼Œä¸å¼ºåˆ¶ï¼‰

`_age`
ä»£è¡¨â€œå†…éƒ¨ä½¿ç”¨â€ï¼Œä½†ä»å¯è®¿é—®ã€‚

## ç§æœ‰å±æ€§ï¼ˆçœŸæ­£éšè—ï¼‰

`__salary`
è‡ªåŠ¨å˜æˆ `_ClassName__salary`ã€‚

```python
class Employee:
    def __init__(self, name, salary):
        self.name = name
        self.__salary = salary  # ç§æœ‰å±æ€§
    
    def get_salary(self):
        return self.__salary

emp = Employee("Tom", 5000)

print(emp.get_salary())
# print(emp.__salary)  # âŒ è®¿é—®å¤±è´¥
print(emp._Employee__salary)  # Python çš„çœŸæ­£ç§æœ‰æœºåˆ¶ï¼ˆåå­—æ”¹å†™ï¼‰
```

---

# **8.8 ç»§æ‰¿ï¼ˆInheritanceï¼‰**

å­ç±»ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚

```python
class Animal:
    def speak(self):
        print("åŠ¨ç‰©å‘å‡ºå£°éŸ³")

class Dog(Animal):
    pass

d = Dog()
d.speak()   # ç»§æ‰¿çˆ¶ç±»æ–¹æ³•
```

---

# **8.9 æ–¹æ³•é‡å†™ï¼ˆOverrideï¼‰ & super()**

å­ç±»å¯ä»¥è¦†ç›–çˆ¶ç±»æ–¹æ³•ã€‚

```python
class Animal:
    def speak(self):
        print("åŠ¨ç‰©å«")

class Dog(Animal):
    def speak(self):
        print("æ±ªæ±ªï¼")  # é‡å†™çˆ¶ç±»æ–¹æ³•

Dog().speak()
```

---

## ä½¿ç”¨ super() è°ƒç”¨çˆ¶ç±»æ–¹æ³•

```python
class Animal:
    def speak(self):
        print("åŠ¨ç‰©å«")

class Dog(Animal):
    def speak(self):
        super().speak()    # è°ƒç”¨çˆ¶ç±»ç‰ˆæœ¬
        print("ä½†æˆ‘æ˜¯ç‹—ï¼Œæˆ‘æ±ªæ±ªå«ï¼")

Dog().speak()
```

---

# **8.10 å¤šé‡ç»§æ‰¿ï¼ˆMultiple Inheritanceï¼‰**

Python æ”¯æŒä¸€ä¸ªç±»ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ã€‚

```python
class A:
    def hello(self):
        print("æ¥è‡ª A")

class B:
    def hello(self):
        print("æ¥è‡ª B")

class C(A, B):
    pass

C().hello()  # MRO å†³å®šè°ƒç”¨ A çš„æ–¹æ³•
```

## MROï¼ˆMethod Resolution Orderï¼‰

Python ä½¿ç”¨ C3 ç®—æ³•å†³å®šæœç´¢é¡ºåºï¼š

```python
print(C.mro())
```

---

# **8.11 å¤šæ€ï¼ˆPolymorphismï¼‰**

ä¸åŒå¯¹è±¡å®ç°ç›¸åŒæ–¹æ³•æ—¶ï¼Œè°ƒç”¨è€…ä¸éœ€è¦çŸ¥é“å¯¹è±¡ç±»å‹ã€‚

```python
class Cat:
    def speak(self):
        print("å–µ")

class Dog:
    def speak(self):
        print("æ±ª")

def animal_speak(animal):
    animal.speak()   # å¤šæ€

animal_speak(Cat())
animal_speak(Dog())
```

---

# **8.12 é­”æœ¯æ–¹æ³•ï¼ˆMagic Methods / Dunder Methodsï¼‰**

å¸¸è§é­”æœ¯æ–¹æ³•ï¼š

| æ–¹æ³•            | ä½œç”¨            |
| ------------- | ------------- |
| `__init__`    | åˆå§‹åŒ–           |
| `__str__`     | æ‰“å°å¯¹è±¡          |
| `__repr__`    | è°ƒè¯•è¾“å‡º          |
| `__len__`     | `len(obj)`    |
| `__add__`     | `obj1 + obj2` |
| `__eq__`      | `==`          |
| `__getitem__` | ç´¢å¼•æ“ä½œ          |
| `__call__`    | å¯¹è±¡åƒå‡½æ•°ä¸€æ ·è°ƒç”¨     |

---

## ç¤ºä¾‹ï¼š`__str__` å’Œ `__repr__`

```python
class Person:
    def __init__(self,name,age):
        self.name = name
        self.age = age

    def __str__(self):
        return f"Person({self.name}, {self.age})"

p = Person("Tom", 18)
print(p)   # è‡ªåŠ¨è°ƒç”¨ __str__
```

---

## ç¤ºä¾‹ï¼šè‡ªå®šä¹‰åŠ æ³•

```python
class Vector:
    def __init__(self, x,y):
        self.x = x
        self.y = y

    def __add__(self, other):
        return Vector(self.x+other.x, self.y+other.y)

    def __repr__(self):
        return f"({self.x},{self.y})"

v1 = Vector(1,2)
v2 = Vector(3,4)

print(v1+v2)
```

---

## ç¤ºä¾‹ï¼šè®©å¯¹è±¡å¯è°ƒç”¨ `__call__`

```python
class Counter:
    def __init__(self):
        self.count = 0
    
    def __call__(self):
        self.count += 1
        print("å½“å‰è®¡æ•°ï¼š", self.count)

c = Counter()
c()  
c()  
```

---

# **8.13 ç±»æ–¹æ³• & é™æ€æ–¹æ³•**

## ç±»æ–¹æ³•ï¼ˆclassmethodï¼‰

ä½œç”¨ï¼šå¸¸ç”¨äºä½œä¸ºâ€œå·¥å‚æ–¹æ³•â€ã€‚

```python
class Person:
    count = 0

    def __init__(self,name):
        self.name = name
        Person.count += 1

    @classmethod
    def how_many(cls):
        return cls.count

p1 = Person("A")
p2 = Person("B")

print(Person.how_many())
```

---

## é™æ€æ–¹æ³•ï¼ˆstaticmethodï¼‰

ä¸ç±»æ— å…³çš„è¾…åŠ©å‡½æ•°ã€‚

```python
class Math:
    @staticmethod
    def add(a,b):
        return a+b

print(Math.add(3,5))
```

---

# **8.14 æŠ½è±¡ç±»ï¼ˆAbstract Classesï¼‰**

æ¥è‡ª `abc` æ¨¡å—ï¼Œç”¨äºå¼ºåˆ¶å­ç±»å®ç°æŸäº›æ–¹æ³•ã€‚

```python
from abc import ABC, abstractmethod

class Animal(ABC):
    @abstractmethod
    def speak(self):
        pass

class Dog(Animal):
    def speak(self):
        print("æ±ªæ±ª")

Dog().speak()
```

---

# **8.15 OOP å®æˆ˜æ¡ˆä¾‹**

---

## **æ¡ˆä¾‹ 1ï¼šå­¦ç”Ÿç®¡ç†ç³»ç»Ÿï¼ˆç±» + æ–¹æ³• + å°è£…ï¼‰**

```python
class Student:
    def __init__(self, name, score):
        self.name = name
        self.__score = score  # ç§æœ‰å±æ€§

    def get_score(self):
        return self.__score

    def set_score(self, value):
        if 0 <= value <= 100:
            self.__score = value
        else:
            print("æˆç»©å¿…é¡»åœ¨ 0-100")

s = Student("Bob", 90)
s.set_score(110)      # æŠ¥é”™
print(s.get_score())
```

---

## **æ¡ˆä¾‹ 2ï¼šé“¶è¡Œè´¦æˆ·ï¼ˆå°è£… + ç§æœ‰å±æ€§ + æ–¹æ³•ï¼‰**

```python
class BankAccount:
    def __init__(self, owner, balance=0):
        self.owner = owner
        self.__balance = balance

    def deposit(self, amount):
        self.__balance += amount

    def withdraw(self, amount):
        if amount > self.__balance:
            print("ä½™é¢ä¸è¶³")
        else:
            self.__balance -= amount

    def show(self):
        print("å½“å‰ä½™é¢ï¼š", self.__balance)

acc = BankAccount("Alice", 100)
acc.deposit(50)
acc.withdraw(200)
acc.show()
```

---

## **æ¡ˆä¾‹ 3ï¼šå›¾ä¹¦ç³»ç»Ÿï¼ˆç»§æ‰¿ + å¤šæ€ï¼‰**

```python
class Book:
    def info(self):
        return "æ™®é€šä¹¦ç±"

class Novel(Book):
    def info(self):
        return "å°è¯´ - Fiction"

class Science(Book):
    def info(self):
        return "ç§‘å­¦ä¹¦ - Science"

books = [Novel(), Science(), Book()]

for b in books:
    print(b.info())  # å¤šæ€
```

---

# **8.16 å°ç»ƒä¹ ï¼ˆExercisesï¼‰**

### **ç»ƒä¹  1**

åˆ›å»ºä¸€ä¸ª `Rectangle` ç±»ï¼ŒåŒ…å«ï¼š

* å®½ widthã€é•¿ height
* `area()` æ–¹æ³•ï¼šè®¡ç®—é¢ç§¯
* `perimeter()` æ–¹æ³•ï¼šè®¡ç®—å‘¨é•¿

### **ç»ƒä¹  2**

è®¾è®¡ä¸€ä¸ªçˆ¶ç±» `Shape`
å¹¶è®© `Circle`ã€`Triangle` ç»§æ‰¿å®ƒï¼Œå®ç° `area()`ã€‚

### **ç»ƒä¹  3**

å®ç°ä¸€ä¸ª `Counter` ç±»ï¼š

* æ¯æ¬¡è°ƒç”¨å¯¹è±¡æ—¶ï¼Œè®©è®¡æ•° +1
* å¯è¾“å‡ºå½“å‰è®¡æ•°ï¼ˆä½¿ç”¨ `__call__`ï¼‰

### **ç»ƒä¹  4**

è‡ªå®šä¹‰ä¸€ä¸ª `Vector` ç±»ï¼Œå®ç°ï¼š

* åŠ æ³• `+`
* é•¿åº¦ `len(v)` ï¼ˆä½¿ç”¨ `__len__`ï¼‰

---


æ˜ç™½äº†ï¼
ä»ç°åœ¨èµ·æˆ‘ä»¬å°†ä¸¥æ ¼æŒ‰ç…§ä½ çš„ç« èŠ‚ç¼–å·ä½“ç³»ï¼š

* **ç¬¬4ç«  = Modules**ï¼ˆå·²å®Œæˆï¼‰
* **ç¬¬5ç«  = NumPy**
* **ç¬¬6ç«  = Files**
* **ç¬¬7ç«  = Regex**ï¼ˆå¦‚æœä½ ä¹‹å‰è®©æˆ‘ä»¬å†™çš„è¯ï¼‰
* **ç¬¬8ç«  = OOP**ï¼ˆå·²å®Œæˆï¼‰
* **ç¬¬9ç«  = Local LLMï¼ˆæœ¬åœ°å¤§è¯­è¨€æ¨¡å‹ï¼‰** â† **ä½ ç°åœ¨è¦æˆ‘å†™çš„å°±æ˜¯è¿™ä¸€ç« **

ä¸‹é¢å¼€å§‹ç”Ÿæˆå®Œæ•´çš„ **ç¬¬ä¹ç« ï¼šæœ¬åœ°å¤§è¯­è¨€æ¨¡å‹ï¼ˆLocal LLM with Pythonï¼‰**
å†…å®¹åŸºäºä½ ä¸Šä¼ çš„ PDFï¼Œå¹¶è¿›è¡Œäº†ä¸“ä¸šçº§æ‰©å±•ï¼ŒåŒæ—¶åŒ…å«å¤§é‡å¸¦ä¸­æ–‡æ³¨é‡Šçš„ Python ä»£ç ç¤ºä¾‹ã€‚

---

# **ç¬¬ä¹ç« ï¼šæœ¬åœ°å¤§è¯­è¨€æ¨¡å‹ï¼ˆLocal LLM with Pythonï¼‰**

---

# ğŸ“‘ **ç›®å½•ï¼ˆTable of Contentsï¼‰**

1. ä»€ä¹ˆæ˜¯æœ¬åœ° LLMï¼ˆLocal LLMï¼‰
2. LLM åŸºæœ¬ç»„æˆï¼ˆTokenizer / Model / Weightsï¼‰
3. æ¨¡å‹æ–‡ä»¶æ ¼å¼ï¼ˆ.bin / .safetensors / .ggufï¼‰
4. HuggingFace Hub ä¸‹è½½æ¨¡å‹
5. ä½¿ç”¨ Transformers åŠ è½½æ¨¡å‹
6. Pipeline å¿«é€Ÿè°ƒç”¨
7. ä½¿ç”¨ AutoModelForCausalLM æ‰‹åŠ¨æ¨ç†
8. CPU / GPU åŠ è½½ä¸ device_map
9. 8-bit / 4-bit æ¨¡å‹é‡åŒ–ï¼ˆé‡åŒ–åŸç† + ç¤ºä¾‹ï¼‰
10. æ„å»ºæœ¬åœ°èŠå¤©æœºå™¨äºº
11. æ–‡æœ¬ç”Ÿæˆå‚æ•°ï¼ˆtemperature ç­‰ï¼‰
12. å®Œæ•´æœ¬åœ° LLM Demo é¡¹ç›®
13. é”™è¯¯å¤„ç†ï¼ˆæ˜¾å­˜ä¸è¶³ã€ç‰ˆæœ¬å†²çªï¼‰
14. æœ¬ç« ç»ƒä¹ é¢˜ä¸ç­”æ¡ˆ

---

# **9.1 ä»€ä¹ˆæ˜¯æœ¬åœ° LLMï¼ˆLocal Large Language Modelï¼‰**

## **ä¸­æ–‡è§£é‡Š**

æœ¬åœ° LLM æŒ‡åœ¨**è‡ªå·±çš„ç”µè„‘ï¼ˆæœ¬åœ°ç¯å¢ƒï¼‰ç›´æ¥è¿è¡Œçš„å¤§è¯­è¨€æ¨¡å‹**ã€‚
æ— éœ€è”ç½‘ã€æ— éœ€ API Keyï¼Œä¼˜ç‚¹åŒ…æ‹¬ï¼š

* âœ” **éšç§å®‰å…¨**ï¼ˆæ–‡æœ¬ä¸ä¸Šä¼ äº‘ç«¯ï¼‰
* âœ” **å…è´¹ï¼ˆæ—  API è°ƒç”¨è´¹ï¼‰**
* âœ” **å¯ä»¥è‡ªå®šä¹‰æ¨¡å‹ä¸å‚æ•°**
* âœ” **é€‚åˆå­¦ä¹ ä¸ç§‘ç ”**
* âœ” **å¯ç¦»çº¿è¿è¡Œ**

å¸¸ç”¨çš„æœ¬åœ°æ¨¡å‹ï¼š

* **LLaMA ç³»åˆ—**
* **Mistral / Mixtral**
* **Qwen ç³»åˆ—**
* **Gemma ç³»åˆ—**
* **Phi ç³»åˆ—ï¼ˆè½»é‡ï¼‰**

---

# **9.2 LLM åŸºæœ¬ç»„æˆï¼ˆTokenizer / Model / Weightsï¼‰**

ä¸€ä¸ª LLM é€šå¸¸ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

### 1) **Tokenizerï¼ˆåˆ†è¯å™¨ï¼‰**

å°†ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬è½¬æ¢æˆ token idï¼ˆæ•°å­—ï¼‰ã€‚

### 2) **Modelï¼ˆæ¨¡å‹ç»“æ„ï¼‰**

å˜æ¢ token çš„ Transformer ç½‘ç»œã€‚

### 3) **Weightsï¼ˆæƒé‡æ–‡ä»¶ï¼‰**

æ¨¡å‹è®­ç»ƒåçš„å‚æ•°ï¼Œé€šå¸¸æ˜¯ï¼š

* 2GB
* 7GB
* 30GB+
* 70GB+

ç¤ºä¾‹æ–‡ä»¶ï¼š

```
pytorch_model.bin
model.safetensors
```

---

# **9.3 æ¨¡å‹æ–‡ä»¶æ ¼å¼**

| æ ¼å¼             | è¯´æ˜               | æ˜¯å¦é€‚åˆæœ¬åœ°è¿è¡Œ       |
| -------------- | ---------------- | -------------- |
| `.bin`         | ä¼ ç»Ÿ PyTorch æƒé‡    | âœ”              |
| `.safetensors` | å®‰å…¨ã€é«˜æ•ˆæ ¼å¼ï¼ˆæ¨èï¼‰      | âœ”âœ”             |
| `.gguf`        | llama.cpp ä¸“ç”¨ä¼˜åŒ–æ ¼å¼ | âœ”âœ”âœ”ï¼ˆæœ€é€‚åˆæœ¬åœ° CPUï¼‰ |

### **ç¤ºä¾‹ï¼ˆåŠ è½½ safetensors æ¨¡å‹ï¼‰**

```python
from transformers import AutoTokenizer, AutoModelForCausalLM

tok = AutoTokenizer.from_pretrained("facebook/opt-350m", trust_remote_code=True)
model = AutoModelForCausalLM.from_pretrained("facebook/opt-350m")
```

---

# **9.4 ä» HuggingFace ä¸‹è½½æ¨¡å‹**

ä¸‹è½½æ¨¡å‹æœ€ç®€æ–¹å¼ï¼š

```python
from huggingface_hub import snapshot_download

snapshot_download(repo_id="microsoft/phi-2")
```

### å¸¦ç¼“å­˜è·¯å¾„ï¼š

```python
snapshot_download(repo_id="microsoft/phi-2", local_dir="models/phi2")
```

---

# **9.5 ä½¿ç”¨ Transformers åŠ è½½æ¨¡å‹**

```python
from transformers import AutoTokenizer, AutoModelForCausalLM

model_name = "microsoft/phi-2"

tokenizer = AutoTokenizer.from_pretrained(model_name)
model = AutoModelForCausalLM.from_pretrained(model_name)
```

---

# **9.6 Pipeline å¿«é€Ÿè°ƒç”¨ï¼ˆæœ€ç®€å•æ–¹å¼ï¼‰**

```python
from transformers import pipeline

pipe = pipeline("text-generation", model="microsoft/phi-2")

result = pipe("Explain machine learning:", max_length=80)
print(result[0]['generated_text'])
```

---

# **9.7 æ‰‹åŠ¨æ¨ç†ï¼ˆAutoModelForCausalLMï¼‰**

```python
import torch
from transformers import AutoTokenizer, AutoModelForCausalLM

model_id = "phi-2"

tok = AutoTokenizer.from_pretrained(model_id)
model = AutoModelForCausalLM.from_pretrained(model_id)

prompt = "Why is the sky blue?"

inputs = tok(prompt, return_tensors="pt")
outputs = model.generate(**inputs, max_new_tokens=50)

print(tok.decode(outputs[0], skip_special_tokens=True))
```

---

# **9.8 CPU / GPU åŠ è½½ï¼ˆdevice_mapï¼‰**

### **è‡ªåŠ¨é€‰æ‹©è®¾å¤‡ï¼ˆæ¨èï¼‰**

```python
model = AutoModelForCausalLM.from_pretrained(
    model_id,
    device_map="auto"
)
```

### **å¼ºåˆ¶ä½¿ç”¨ GPU**

```python
model.to("cuda")
```

### **å¼ºåˆ¶ä½¿ç”¨ CPU**

```python
model.to("cpu")
```

---

# **9.9 é‡åŒ–æ¨¡å‹ï¼ˆ4-bit / 8-bitï¼‰**

é‡åŒ–çš„ç”¨é€”ï¼š

* å‡å°‘æ˜¾å­˜å ç”¨
* åŠ é€Ÿæ¨ç†
* è®©å¤§æ¨¡å‹åœ¨å°æ˜¾å¡ä¸Šè·‘å¾—åŠ¨

### ä½¿ç”¨ BitsAndBytes é‡åŒ–ï¼š

```python
from transformers import AutoModelForCausalLM
from transformers import BitsAndBytesConfig

bnb_config = BitsAndBytesConfig(
    load_in_8bit=True
)

model = AutoModelForCausalLM.from_pretrained(
    "microsoft/phi-2",
    quantization_config=bnb_config,
    device_map="auto"
)
```

---

# **9.10 æ„å»ºæœ¬åœ°èŠå¤©æœºå™¨äºº**

```python
from transformers import AutoTokenizer, AutoModelForCausalLM

tok = AutoTokenizer.from_pretrained("phi-2")
model = AutoModelForCausalLM.from_pretrained("phi-2", device_map="auto")

def chat(user_input):
    prompt = f"User: {user_input}\nAssistant:"
    inputs = tok(prompt, return_tensors="pt").to(model.device)
    outputs = model.generate(**inputs, max_new_tokens=100)
    return tok.decode(outputs[0], skip_special_tokens=True)

print(chat("What is AI?"))
```

---

# **9.11 æ–‡æœ¬ç”Ÿæˆå‚æ•°**

| å‚æ•°                 | è¯´æ˜               |
| ------------------ | ---------------- |
| max_new_tokens     | ç”Ÿæˆæ–‡æœ¬é•¿åº¦           |
| temperature        | åˆ›é€ æ€§ç¨‹åº¦            |
| top_k              | ä»å‰ k ä¸ª token é‡‡æ ·  |
| top_p              | nucleus sampling |
| repetition_penalty | é™ä½é‡å¤æ¦‚ç‡           |

ç¤ºä¾‹ï¼š

```python
outputs = model.generate(
    **inputs,
    max_new_tokens=100,
    temperature=0.7,
    top_p=0.9
)
```

---

# **9.12 å®Œæ•´æœ¬åœ° LLM Demo é¡¹ç›®**

```python
from transformers import AutoTokenizer, AutoModelForCausalLM

model_name = "microsoft/phi-2"

tokenizer = AutoTokenizer.from_pretrained(model_name)
model = AutoModelForCausalLM.from_pretrained(model_name, device_map="auto")

while True:
    text = input("ä½ ï¼š")
    if text == "exit":
        break

    prompt = f"User:{text}\nAssistant:"
    inputs = tokenizer(prompt, return_tensors="pt").to(model.device)

    outputs = model.generate(
        **inputs,
        max_new_tokens=80,
        temperature=0.7
    )

    print("AIï¼š", tokenizer.decode(outputs[0], skip_special_tokens=True))
```

---

# **9.13 å¸¸è§é—®é¢˜æ’æŸ¥**

## âŒ **é—®é¢˜ 1ï¼šCUDA å†…å­˜ä¸è¶³**

è§£å†³ï¼š

```python
torch.cuda.empty_cache()
```

æˆ–ï¼š

* ä½¿ç”¨ 8bit/4bit é‡åŒ–
* ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼ˆphi-2 / gemma-2bï¼‰

---

## âŒ **é—®é¢˜ 2ï¼šmodel.safetensors ä¸å—æ”¯æŒ**

æ›´æ–° transformersï¼š

```bash
pip install -U transformers
pip install -U safetensors
```

---

## âŒ **é—®é¢˜ 3ï¼šNo module named bitsandbytes**

è§£å†³ï¼š

```bash
pip install bitsandbytes
```

---

# **9.14 æœ¬ç« ç»ƒä¹ é¢˜**

### **ç»ƒä¹  1**

ä½¿ç”¨ pipeline æ„å»ºä¸€ä¸ªç®€å•é—®ç­”æœºå™¨äººã€‚

### **ç»ƒä¹  2**

åŠ è½½ä¸€ä¸ª 8-bit æ¨¡å‹å¹¶è¿›è¡Œæ¨ç†ã€‚

### **ç»ƒä¹  3**

ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå®ç°ï¼š

```
chat(prompt, temperature=0.8, max_new_tokens=80)
```

### **ç»ƒä¹  4**

è§£é‡Š top_kã€top_pã€temperature çš„ä¸åŒä½œç”¨ã€‚

---


